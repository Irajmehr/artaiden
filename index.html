<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Artin & Aiden ‚Ä¢ Behavior Tracker</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåü</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; scroll-behavior: smooth; }
    body {
      font-family: 'Source Sans 3', -apple-system, sans-serif;
      background: linear-gradient(165deg, #FDF8F3 0%, #E5D4B7 50%, #D4B996 100%);
      min-height: 100vh;
      color: #4A4A4A;
    }
    h1, h2, h3, h4 { font-family: 'Playfair Display', Georgia, serif; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #E5D4B7; }
    ::-webkit-scrollbar-thumb { background: #A8916B; border-radius: 3px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spin { animation: spin 1s linear infinite; }
    .btn-bounce:active { transform: scale(0.92); }
    .mobile-nav { display: none; }
    @media (max-width: 1024px) {
      .three-panel { flex-direction: column !important; align-items: center !important; }
      .side-panel { min-width: 100% !important; max-width: 600px !important; width: 100% !important; }
      .center-panel { order: -1 !important; min-width: 100% !important; max-width: 600px !important; }
      .mobile-nav { 
        display: flex !important; position: sticky; top: 56px; z-index: 99;
        background: white; padding: 10px 16px; gap: 8px;
        border-bottom: 1px solid #E5D4B7; justify-content: center;
      }
      .mobile-nav button {
        flex: 1; max-width: 140px; padding: 12px 14px; border-radius: 12px;
        border: none; font-weight: 600; font-size: 1rem; cursor: pointer;
        display: flex; align-items: center; justify-content: center; gap: 6px;
      }
    }
    @media (max-width: 768px) { html { font-size: 15px; } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxuEp2AwHSV3rN7D1Je1btpdtG1quMi6aaazCqqSxUJUq1rOfWzkXVb81Y2wnMQaC5O/exec';

const VIEWER_PASSWORD = 'artaiden';
const ADMIN_PASSWORD = '8006005';

const Icon = ({ name, size = 24, color = 'currentColor' }) => {
  const ref = useRef(null);
  useEffect(() => {
    if (ref.current && lucide.icons[name]) {
      ref.current.innerHTML = '';
      const icon = lucide.createElement(lucide.icons[name]);
      icon.setAttribute('width', size);
      icon.setAttribute('height', size);
      icon.setAttribute('stroke', color);
      icon.setAttribute('stroke-width', '2');
      ref.current.appendChild(icon);
    }
  }, [name, size, color]);
  return <span ref={ref} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }} />;
};

// Behaviors
const behaviorsByCategory = {
  'Punctuality': {
    icon: 'Clock', color: '#B8D4E8', textColor: '#2C3E50',
    items: [
      { id: 'wake', label: 'Waking up', posLabel: 'Woke up on time', negLabel: 'Woke up late', points: 10, icon: 'Sunrise' },
      { id: 'school-ready', label: 'Ready for school', posLabel: 'Ready on time', negLabel: 'Late for school', points: 10, icon: 'Backpack' },
      { id: 'homework-start', label: 'Starting homework', posLabel: 'Started on time', negLabel: 'Started late', points: 10, icon: 'PenLine' },
      { id: 'bed', label: 'Going to bed', posLabel: 'Bed on time', negLabel: 'Bed late', points: 10, icon: 'Moon' },
    ]
  },
  'Eating': {
    icon: 'Utensils', color: '#C9E4CA', textColor: '#2D5A2E',
    items: [
      { id: 'breakfast', label: 'Breakfast', posLabel: 'Ate breakfast', negLabel: 'Skipped breakfast', points: 10, icon: 'Coffee' },
      { id: 'lunch-school', label: 'School lunch', posLabel: 'Ate school lunch', negLabel: 'Skipped lunch', points: 10, icon: 'Sandwich' },
      { id: 'snacks-school', label: 'School snacks', posLabel: 'Ate snacks', negLabel: 'Skipped snacks', points: 5, icon: 'Cookie' },
      { id: 'vegetables', label: 'Vegetables', posLabel: 'Ate vegetables', negLabel: 'Refused vegetables', points: 15, icon: 'Salad' },
      { id: 'fruits', label: 'Fruits', posLabel: 'Ate fruits', negLabel: 'Refused fruits', points: 10, icon: 'Apple' },
      { id: 'finish-meal', label: 'Finish meal', posLabel: 'Finished meal', negLabel: 'Did not finish', points: 10, icon: 'UtensilsCrossed' },
    ]
  },
  'School': {
    icon: 'School', color: '#FFF3CD', textColor: '#856404',
    items: [
      { id: 'school-math', label: 'Math', posLabel: 'Good in Math', negLabel: 'Struggled in Math', points: 15, icon: 'Calculator' },
      { id: 'school-science', label: 'Science', posLabel: 'Good in Science', negLabel: 'Struggled in Science', points: 15, icon: 'FlaskConical' },
      { id: 'school-reading', label: 'Reading', posLabel: 'Good in Reading', negLabel: 'Struggled in Reading', points: 15, icon: 'BookOpen' },
      { id: 'school-writing', label: 'Writing', posLabel: 'Good in Writing', negLabel: 'Struggled in Writing', points: 15, icon: 'Pencil' },
      { id: 'school-music', label: 'Music', posLabel: 'Good in Music', negLabel: 'Struggled in Music', points: 10, icon: 'Music' },
      { id: 'school-gym', label: 'Gym', posLabel: 'Good in Gym', negLabel: 'Struggled in Gym', points: 10, icon: 'Dumbbell' },
      { id: 'school-drama', label: 'Drama', posLabel: 'Good in Drama', negLabel: 'Struggled in Drama', points: 10, icon: 'Theater' },
      { id: 'school-dpa', label: 'DPA', posLabel: 'Did DPA', negLabel: 'Missed DPA', points: 10, icon: 'HeartPulse' },
    ]
  },
  'Learning': {
    icon: 'GraduationCap', color: '#E8D4B8', textColor: '#5A4A2D',
    items: [
      { id: 'homework', label: 'Homework', posLabel: 'Completed homework', negLabel: 'Incomplete', points: 15, icon: 'ClipboardCheck' },
      { id: 'reading', label: 'Reading 20min', posLabel: 'Read 20 minutes', negLabel: 'Did not read', points: 15, icon: 'BookMarked' },
      { id: 'book-chapter', label: 'Book chapter', posLabel: 'Finished chapter', negLabel: 'Did not finish', points: 20, icon: 'BookCheck' },
    ]
  },
  'Character': {
    icon: 'Heart', color: '#E8B8D4', textColor: '#5A2D4A',
    items: [
      { id: 'kind-words', label: 'Kind words', posLabel: 'Used kind words', negLabel: 'Unkind words', points: 5, icon: 'MessageCircleHeart' },
      { id: 'sharing', label: 'Sharing', posLabel: 'Shared nicely', negLabel: 'Did not share', points: 10, icon: 'Users' },
      { id: 'manners', label: 'Good manners', posLabel: 'Good manners', negLabel: 'Bad manners', points: 5, icon: 'Sparkles' },
      { id: 'helping', label: 'Helping', posLabel: 'Helped voluntarily', negLabel: 'Refused to help', points: 15, icon: 'HandHelping' },
      { id: 'no-fighting', label: 'No fighting', posLabel: 'No fighting today', negLabel: 'Fought with sibling', points: 10, icon: 'Swords' },
      { id: 'respect', label: 'Respectful', posLabel: 'Was respectful', negLabel: 'Talked back', points: 10, icon: 'MessageSquare' },
    ]
  },
  'Responsibility': {
    icon: 'CheckSquare', color: '#D4B8E8', textColor: '#4A2D5A',
    items: [
      { id: 'chores', label: 'Chores', posLabel: 'Did chores', negLabel: 'Skipped chores', points: 10, icon: 'Brush' },
      { id: 'basketball', label: 'Basketball', posLabel: 'Attended basketball', negLabel: 'Skipped basketball', points: 15, icon: 'Dribbble' },
      { id: 'clean-room', label: 'Clean room', posLabel: 'Cleaned room', negLabel: 'Messy room', points: 10, icon: 'Home' },
    ]
  },
  'Screen Time': {
    icon: 'Smartphone', color: '#FFE4E4', textColor: '#8B3A3A',
    items: [
      { id: 'no-youtube', label: 'No YT shorts', posLabel: 'No YouTube shorts', negLabel: 'Watched YT shorts', points: 5, icon: 'Youtube' },
      { id: 'screen-limit', label: 'Screen limit', posLabel: 'Within screen limit', negLabel: 'Exceeded screen', points: 10, icon: 'MonitorOff' },
    ]
  }
};

const allBehaviorIds = [];
Object.values(behaviorsByCategory).forEach(cat => cat.items.forEach(item => allBehaviorIds.push(item.id)));

const isWeekend = () => { const d = new Date().getDay(); return d === 0 || d === 6; };

const rewards = [
  { id: 'game10', points: 15, label: '10 min Game', icon: 'Gamepad2', category: 'game' },
  { id: 'game15', points: 25, label: '15 min Game', icon: 'Gamepad2', category: 'game' },
  { id: 'game20', points: 35, label: '20 min Game', icon: 'Gamepad', category: 'game' },
  { id: 'game30', points: 50, label: '30 min Game ‚≠ê', icon: 'Gamepad', category: 'game' },
  { id: 'game45', points: 75, label: '45 min Game üéÆ', icon: 'Trophy', category: 'game-weekend' },
  { id: 'game60', points: 100, label: '60 min Game üéÆ', icon: 'Trophy', category: 'game-weekend' },
  { id: 'tv30', points: 30, label: '30 min TV', icon: 'Tv', category: 'other' },
  { id: 'snack', points: 40, label: 'Special Snack', icon: 'Popcorn', category: 'other' },
  { id: 'movie', points: 60, label: 'Movie Night', icon: 'Film', category: 'other' },
  { id: 'stayup', points: 70, label: 'Stay Up Late', icon: 'MoonStar', category: 'other' },
  { id: 'wish', points: 100, label: 'Free Wish', icon: 'Star', category: 'other' },
  { id: 'outing', points: 150, label: 'Special Outing', icon: 'PartyPopper', category: 'other' },
];

const restrictions = [
  { threshold: 0, label: 'No Games', icon: 'Gamepad2' },
  { threshold: -10, label: 'No TV', icon: 'Tv' },
  { threshold: -20, label: 'No YouTube', icon: 'Youtube' },
  { threshold: -30, label: 'Early Bed', icon: 'Moon' },
];

const today = () => {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
};

const getColor = s => s >= 100 ? '#4F7942' : s >= 50 ? '#6B8E4E' : s >= 20 ? '#87CEEB' : s >= 0 ? '#C9A882' : s >= -20 ? '#D4966B' : '#B85C38';
const formatDate = () => new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
const formatDateTime = (ts) => new Date(ts).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });

const getWeekStart = () => {
  const d = new Date();
  d.setDate(d.getDate() - d.getDay());
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
};

const getMonthStart = () => {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-01`;
};

const extractBehaviorId = (entry) => {
  let bid = entry.behaviorId || entry.id || '';
  for (const knownId of allBehaviorIds) {
    if (bid === knownId || bid.startsWith(knownId + '-')) return knownId;
  }
  bid = bid.replace(/-pos$/, '').replace(/-neg$/, '').replace(/-pos-.*$/, '').replace(/-neg-.*$/, '');
  return bid;
};

const extractType = (entry) => {
  if (entry.type === 'positive' || entry.type === 'negative') return entry.type;
  const bid = entry.behaviorId || entry.id || '';
  if (bid.includes('-pos')) return 'positive';
  if (bid.includes('-neg')) return 'negative';
  if (entry.points > 0) return 'positive';
  if (entry.points < 0) return 'negative';
  return null;
};

const calculateScores = (history) => {
  const scores = { Artin: 0, Aiden: 0 };
  ['Artin', 'Aiden'].forEach(name => {
    scores[name] = (history[name] || []).reduce((sum, h) => sum + (h.points || 0), 0);
  });
  return scores;
};

const calculateWeeklyScores = (history) => {
  const weekStart = getWeekStart();
  const scores = { Artin: 0, Aiden: 0 };
  ['Artin', 'Aiden'].forEach(name => {
    scores[name] = (history[name] || []).filter(h => h.date >= weekStart).reduce((sum, h) => sum + (h.points || 0), 0);
  });
  return scores;
};

const calculateMonthlyScores = (history) => {
  const monthStart = getMonthStart();
  const scores = { Artin: 0, Aiden: 0 };
  ['Artin', 'Aiden'].forEach(name => {
    scores[name] = (history[name] || []).filter(h => h.date >= monthStart).reduce((sum, h) => sum + (h.points || 0), 0);
  });
  return scores;
};

const calculateTodayScores = (history) => {
  const todayStr = today();
  const scores = { Artin: 0, Aiden: 0 };
  ['Artin', 'Aiden'].forEach(name => {
    scores[name] = (history[name] || []).filter(h => h.date === todayStr).reduce((sum, h) => sum + (h.points || 0), 0);
  });
  return scores;
};

const buildDailyStates = (history) => {
  const todayStr = today();
  const states = { Artin: {}, Aiden: {} };
  ['Artin', 'Aiden'].forEach(name => {
    const todayHistory = (history[name] || []).filter(h => h.date === todayStr);
    todayHistory.forEach(h => {
      const behaviorId = extractBehaviorId(h);
      const type = extractType(h);
      if (behaviorId && type && type !== 'reward') {
        states[name][behaviorId] = type;
      }
    });
  });
  return states;
};

const api = {
  async getData() {
    try {
      const res = await fetch(`${GOOGLE_SCRIPT_URL}?action=getData`);
      return res.json();
    } catch (e) { return null; }
  },
  async recordBehavior(child, behavior) {
    try { return fetch(GOOGLE_SCRIPT_URL + '?action=recordBehavior', { method: 'POST', body: JSON.stringify({ child, behavior }) }).then(r => r.json()); }
    catch (e) { return { success: true }; }
  },
  async undoLast(child) {
    try { return fetch(GOOGLE_SCRIPT_URL + '?action=undoLast', { method: 'POST', body: JSON.stringify({ child }) }).then(r => r.json()); }
    catch (e) { return { success: true }; }
  },
  async resetChild(child) {
    try { return fetch(GOOGLE_SCRIPT_URL + '?action=resetChild', { method: 'POST', body: JSON.stringify({ child }) }).then(r => r.json()); }
    catch (e) { return { success: true }; }
  },
  async claimReward(child, reward) {
    try { return fetch(GOOGLE_SCRIPT_URL + '?action=claimReward', { method: 'POST', body: JSON.stringify({ child, reward }) }).then(r => r.json()); }
    catch (e) { return { success: true }; }
  }
};

function PasswordScreen({ onUnlock }) {
  const [pw, setPw] = useState('');
  const [err, setErr] = useState(false);
  
  const submit = e => { 
    e.preventDefault(); 
    if (pw === ADMIN_PASSWORD) { localStorage.setItem('bt_auth', 'admin'); onUnlock('admin'); }
    else if (pw === VIEWER_PASSWORD) { localStorage.setItem('bt_auth', 'viewer'); onUnlock('viewer'); }
    else { setErr(true); setTimeout(() => setErr(false), 2000); }
  };
  
  return (
    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
      <div style={{ background: 'white', borderRadius: 20, padding: '40px 36px', boxShadow: '0 16px 48px rgba(74,74,74,0.15)', textAlign: 'center', maxWidth: 400, width: '100%', border: '1px solid #E5D4B7' }}>
        <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'linear-gradient(135deg, #C9A882 0%, #A8916B 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 20px' }}>
          <Icon name="Lock" size={36} color="white" />
        </div>
        <h1 style={{ margin: '0 0 6px', color: '#4A4A4A', fontSize: '1.9rem' }}>Behavior Tracker</h1>
        <p style={{ color: '#888', marginBottom: 24, fontSize: '1.1rem' }}>Enter password</p>
        <form onSubmit={submit}>
          <input type="password" value={pw} onChange={e => setPw(e.target.value)} placeholder="Password" style={{ width: '100%', padding: '16px 20px', borderRadius: 10, border: `2px solid ${err ? '#B85C38' : '#E5D4B7'}`, fontSize: '1.1rem', marginBottom: 16, outline: 'none' }} />
          {err && <p style={{ color: '#B85C38', marginBottom: 12, fontSize: '1rem' }}>Incorrect password</p>}
          <button type="submit" style={{ width: '100%', padding: '16px', borderRadius: 10, border: 'none', background: 'linear-gradient(135deg, #4F7942 0%, #6B8E4E 100%)', color: 'white', fontSize: '1.15rem', fontWeight: 600, cursor: 'pointer' }}>Enter</button>
        </form>
      </div>
    </div>
  );
}

function Avatar({ name, avatar, onUpload, isAdmin }) {
  const inputRef = useRef(null);
  const handleUpload = (e) => {
    if (!isAdmin) return;
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => onUpload(name, reader.result);
      reader.readAsDataURL(file);
    }
  };

  return (
    <div style={{ position: 'relative', width: 110, height: 110, flexShrink: 0 }}>
      <div onClick={() => isAdmin && inputRef.current?.click()} style={{
        width: '100%', height: '100%', borderRadius: '50%', overflow: 'hidden',
        background: avatar ? 'none' : 'linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%)',
        display: 'flex', alignItems: 'center', justifyContent: 'center',
        cursor: isAdmin ? 'pointer' : 'default', border: '4px solid rgba(255,255,255,0.5)', boxShadow: '0 6px 20px rgba(0,0,0,0.2)'
      }}>
        {avatar ? <img src={avatar} alt={name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} /> : <Icon name="User" size={50} color="rgba(255,255,255,0.8)" />}
      </div>
      {isAdmin && (
        <div style={{ position: 'absolute', bottom: 2, right: 2, width: 32, height: 32, borderRadius: '50%', background: '#4F7942', display: 'flex', alignItems: 'center', justifyContent: 'center', border: '2px solid white', cursor: 'pointer' }} onClick={() => inputRef.current?.click()}>
          <Icon name="Camera" size={16} color="white" />
        </div>
      )}
      <input ref={inputRef} type="file" accept="image/*" onChange={handleUpload} style={{ display: 'none' }} />
    </div>
  );
}

function BehaviorRow({ item, dailyState, onRecord, loading, isAdmin }) {
  const state = dailyState || null;
  
  return (
    <div style={{ 
      display: 'flex', alignItems: 'center', gap: 10, padding: '12px 10px', 
      borderRadius: 12, marginBottom: 5,
      background: state === 'positive' ? '#E8F5E9' : state === 'negative' ? '#FFEBEE' : '#FAFAFA',
      border: state ? `2px solid ${state === 'positive' ? '#4F7942' : '#B85C38'}` : '1px solid #E5D4B7',
    }}>
      {isAdmin ? (
        <button onClick={() => !loading && onRecord(item, 'negative')} className="btn-bounce" style={{
          width: 44, height: 44, borderRadius: 10, border: state === 'negative' ? '2px solid #8B0000' : 'none',
          background: state === 'negative' ? '#B85C38' : '#E57373',
          color: 'white', cursor: loading ? 'default' : 'pointer',
          display: 'flex', alignItems: 'center', justifyContent: 'center',
          opacity: state === 'positive' ? 0.3 : 1, flexShrink: 0,
          transform: state === 'negative' ? 'scale(1.08)' : 'scale(1)',
        }}>
          {state === 'negative' ? <Icon name="Check" size={20} color="white" /> : <Icon name="Minus" size={20} color="white" />}
        </button>
      ) : (
        <div style={{ width: 36, height: 36, borderRadius: 8, background: state === 'negative' ? '#B85C38' : '#E5D4B7', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>
          {state === 'negative' && <Icon name="X" size={16} color="white" />}
        </div>
      )}

      <div style={{ flex: 1, display: 'flex', alignItems: 'center', gap: 10, minWidth: 0 }}>
        <div style={{ 
          width: 40, height: 40, borderRadius: 10, flexShrink: 0,
          background: state === 'positive' ? '#4F7942' : state === 'negative' ? '#B85C38' : '#F0EBE5', 
          display: 'flex', alignItems: 'center', justifyContent: 'center'
        }}>
          <Icon name={item.icon} size={20} color={state ? 'white' : '#A8916B'} />
        </div>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ 
            fontWeight: 600, fontSize: '1rem',
            color: state === 'positive' ? '#2D5A2E' : state === 'negative' ? '#8B0000' : '#4A4A4A',
            whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis'
          }}>
            {state === 'positive' ? '‚úì ' + item.posLabel : state === 'negative' ? '‚úó ' + item.negLabel : item.label}
          </div>
          <div style={{ fontSize: '0.85rem', color: state === 'positive' ? '#4F7942' : state === 'negative' ? '#B85C38' : '#888', fontWeight: state ? 600 : 400 }}>
            {state === 'positive' ? '+' + item.points : state === 'negative' ? '-' + item.points : '¬±' + item.points} pts
          </div>
        </div>
      </div>

      {isAdmin ? (
        <button onClick={() => !loading && onRecord(item, 'positive')} className="btn-bounce" style={{
          width: 44, height: 44, borderRadius: 10, border: state === 'positive' ? '2px solid #2D5A2E' : 'none',
          background: state === 'positive' ? '#4F7942' : '#66BB6A',
          color: 'white', cursor: loading ? 'default' : 'pointer',
          display: 'flex', alignItems: 'center', justifyContent: 'center',
          opacity: state === 'negative' ? 0.3 : 1, flexShrink: 0,
          transform: state === 'positive' ? 'scale(1.08)' : 'scale(1)',
        }}>
          {state === 'positive' ? <Icon name="Check" size={20} color="white" /> : <Icon name="Plus" size={20} color="white" />}
        </button>
      ) : (
        <div style={{ width: 36, height: 36, borderRadius: 8, background: state === 'positive' ? '#4F7942' : '#E5D4B7', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>
          {state === 'positive' && <Icon name="Check" size={16} color="white" />}
        </div>
      )}
    </div>
  );
}

function ChildPanel({ name, scores, weeklyScores, todayScores, history, dailyStates, avatar, onRecord, onUndo, onReset, onAvatarUpload, loading, isAdmin, panelId }) {
  const score = scores[name] || 0;
  const weeklyScore = weeklyScores[name] || 0;
  const todayScore = todayScores[name] || 0;
  const childHistory = history[name] || [];
  const childDailyState = dailyStates[name] || {};
  const activeRestrictions = restrictions.filter(r => score <= r.threshold);
  const hasRestrictions = activeRestrictions.length > 0;
  const [expandedCat, setExpandedCat] = useState(null);

  const totalCompleted = Object.keys(childDailyState).length;
  const totalBehaviors = Object.values(behaviorsByCategory).reduce((sum, cat) => sum + cat.items.length, 0);

  return (
    <div id={panelId} className="side-panel" style={{ 
      background: 'white', borderRadius: 18, 
      boxShadow: '0 6px 24px rgba(74,74,74,0.1)', 
      border: hasRestrictions ? '3px solid #B85C38' : '1px solid #E5D4B7',
      overflow: 'hidden', minWidth: 380, maxWidth: 460, flex: 1
    }}>
      <div style={{ 
        background: `linear-gradient(135deg, ${getColor(score)} 0%, ${getColor(score)}cc 100%)`, 
        padding: '14px 16px', color: 'white',
        display: 'flex', alignItems: 'center', gap: 16
      }}>
        <Avatar name={name} avatar={avatar} onUpload={onAvatarUpload} isAdmin={isAdmin} />
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ display: 'flex', alignItems: 'baseline', gap: 10 }}>
            <h2 style={{ margin: 0, fontSize: '1.6rem', fontWeight: 600 }}>{name}</h2>
            <span style={{ fontSize: '2rem', fontWeight: 700 }}>{score}</span>
            <span style={{ fontSize: '1rem', opacity: 0.9 }}>pts</span>
          </div>
          <div style={{ display: 'flex', gap: 8, marginTop: 6, flexWrap: 'wrap' }}>
            <span style={{ background: 'rgba(255,255,255,0.2)', padding: '4px 10px', borderRadius: 8, fontSize: '0.9rem' }}>
              Today: <b>{todayScore >= 0 ? '+' : ''}{todayScore}</b>
            </span>
            <span style={{ background: 'rgba(255,255,255,0.2)', padding: '4px 10px', borderRadius: 8, fontSize: '0.9rem' }}>
              Week: <b>{weeklyScore >= 0 ? '+' : ''}{weeklyScore}</b>
            </span>
            <span style={{ background: 'rgba(255,255,255,0.2)', padding: '4px 10px', borderRadius: 8, fontSize: '0.9rem' }}>
              {totalCompleted}/{totalBehaviors}
            </span>
          </div>
          {!isAdmin && (
            <div style={{ marginTop: 6, fontSize: '0.85rem', opacity: 0.8, display: 'flex', alignItems: 'center', gap: 4 }}>
              <Icon name="Eye" size={14} color="white" /> View Only
            </div>
          )}
        </div>
      </div>

      <div style={{ padding: 12 }}>
        {hasRestrictions && (
          <div style={{ background: '#FEF2F2', border: '1px solid #FECACA', borderRadius: 10, padding: 10, marginBottom: 10, display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap' }}>
            <Icon name="AlertTriangle" size={18} color="#B85C38" />
            {activeRestrictions.map(r => (<span key={r.threshold} style={{ padding: '3px 8px', background: 'white', borderRadius: 6, color: '#B85C38', fontSize: '0.85rem', fontWeight: 500 }}>{r.label}</span>))}
          </div>
        )}

        {score >= 15 && !hasRestrictions && (
          <div style={{ background: '#FEF7ED', border: '1px solid #FCD9B6', borderRadius: 10, padding: 10, marginBottom: 10, display: 'flex', alignItems: 'center', gap: 8 }}>
            <Icon name="Gift" size={18} color="#C9A882" />
            <span style={{ fontSize: '0.95rem', color: '#92400E', fontWeight: 500 }}>Rewards available!</span>
          </div>
        )}

        {isAdmin && (
          <div style={{ background: '#E3F2FD', borderRadius: 8, padding: '8px 10px', marginBottom: 10, fontSize: '0.9rem', color: '#1565C0', display: 'flex', alignItems: 'center', gap: 6 }}>
            <Icon name="Info" size={16} color="#1565C0" /> Tap +/- to assign or swap
          </div>
        )}

        <div style={{ maxHeight: 'calc(100vh - 320px)', overflowY: 'auto' }}>
          {Object.entries(behaviorsByCategory).map(([catName, cat]) => {
            const completedCount = cat.items.filter(item => childDailyState[item.id]).length;
            const positiveCount = cat.items.filter(item => childDailyState[item.id] === 'positive').length;
            const negativeCount = cat.items.filter(item => childDailyState[item.id] === 'negative').length;
            
            return (
              <div key={catName} style={{ marginBottom: 6 }}>
                <button onClick={() => setExpandedCat(expandedCat === catName ? null : catName)} style={{ 
                  width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between', 
                  padding: '10px 12px', background: cat.color, borderRadius: 10, border: 'none', cursor: 'pointer' 
                }}>
                  <span style={{ display: 'flex', alignItems: 'center', gap: 8, fontWeight: 600, color: cat.textColor, fontSize: '1rem' }}>
                    <Icon name={cat.icon} size={20} color={cat.textColor} />{catName}
                  </span>
                  <span style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                    {positiveCount > 0 && <span style={{ color: '#4F7942', fontSize: '0.85rem', fontWeight: 600 }}>+{positiveCount}</span>}
                    {negativeCount > 0 && <span style={{ color: '#B85C38', fontSize: '0.85rem', fontWeight: 600 }}>-{negativeCount}</span>}
                    <span style={{ fontSize: '0.9rem', color: cat.textColor, fontWeight: 600, background: completedCount > 0 ? 'rgba(255,255,255,0.5)' : 'transparent', padding: '2px 8px', borderRadius: 6 }}>{completedCount}/{cat.items.length}</span>
                    <Icon name={expandedCat === catName ? 'ChevronUp' : 'ChevronDown'} size={20} color={cat.textColor} />
                  </span>
                </button>
                {expandedCat === catName && (
                  <div style={{ paddingTop: 8 }}>
                    {cat.items.map(item => (
                      <BehaviorRow 
                        key={item.id} 
                        item={item} 
                        dailyState={childDailyState[item.id]} 
                        onRecord={(item, type) => onRecord(name, item, type)} 
                        loading={loading} 
                        isAdmin={isAdmin} 
                      />
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>

        {isAdmin && (
          <div style={{ display: 'flex', gap: 10, marginTop: 12 }}>
            <button onClick={() => onUndo(name)} disabled={!childHistory.length || loading} style={{ flex: 1, padding: 12, borderRadius: 10, border: '1px dashed #D4B996', background: childHistory.length ? 'white' : '#F5F5F5', color: childHistory.length ? '#666' : '#bbb', cursor: childHistory.length ? 'pointer' : 'not-allowed', fontSize: '0.95rem', fontWeight: 500, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 6 }}>
              <Icon name="Undo2" size={18} /> Undo
            </button>
            <button onClick={() => onReset(name)} style={{ flex: 1, padding: 12, borderRadius: 10, border: 'none', background: '#FFEBEE', color: '#B85C38', fontSize: '0.95rem', fontWeight: 500, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 6 }}>
              <Icon name="RotateCcw" size={18} /> Reset
            </button>
          </div>
        )}
      </div>
    </div>
  );
}

function CenterPanel({ scores, weeklyScores, history, dailyStates, claimHistory, onClaimReward, isAdmin }) {
  const [view, setView] = useState('charts');
  const monthlyScores = useMemo(() => calculateMonthlyScores(history), [history]);
  const weekend = isWeekend();
  
  return (
    <div id="center-panel" className="center-panel" style={{ flex: 1, minWidth: 300, maxWidth: 400, display: 'flex', flexDirection: 'column', gap: 12 }}>
      <div style={{ background: 'white', borderRadius: 14, padding: 12, textAlign: 'center', boxShadow: '0 3px 12px rgba(0,0,0,0.06)', border: '1px solid #E5D4B7' }}>
        <div style={{ fontSize: '1.2rem', fontWeight: 600, color: '#4A4A4A' }}>{formatDate()}</div>
        {weekend && <div style={{ fontSize: '0.85rem', color: '#4F7942', marginTop: 3 }}>üéÆ Weekend - 60min game max!</div>}
      </div>

      <div style={{ display: 'flex', gap: 6 }}>
        {[['charts', 'BarChart3'], ['rewards', 'Gift'], ['history', 'Clock']].map(([v, icon]) => (
          <button key={v} onClick={() => setView(v)} style={{ flex: 1, padding: '8px', borderRadius: 8, border: view === v ? 'none' : '1px solid #D4B996', background: view === v ? '#4F7942' : 'white', color: view === v ? 'white' : '#4A4A4A', fontSize: '0.9rem', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
            <Icon name={icon} size={16} color={view === v ? 'white' : '#4F7942'} /> {v.charAt(0).toUpperCase() + v.slice(1)}
          </button>
        ))}
      </div>

      {view === 'charts' && (
        <div style={{ background: 'white', borderRadius: 14, padding: 12, boxShadow: '0 3px 12px rgba(0,0,0,0.06)', border: '1px solid #E5D4B7' }}>
          <div style={{ display: 'flex', justifyContent: 'space-around', marginBottom: 12 }}>
            {['Artin', 'Aiden'].map(n => (
              <div key={n} style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '1.8rem', fontWeight: 700, color: getColor(scores[n] || 0) }}>{scores[n] || 0}</div>
                <div style={{ fontSize: '0.85rem', color: '#888' }}>{n}</div>
                <div style={{ fontSize: '0.75rem', color: '#aaa' }}>W:{weeklyScores[n]||0} M:{monthlyScores[n]||0}</div>
              </div>
            ))}
          </div>
          
          <div style={{ borderTop: '1px solid #E5D4B7', paddingTop: 10 }}>
            <div style={{ fontSize: '0.9rem', fontWeight: 600, color: '#4A4A4A', marginBottom: 8, textAlign: 'center' }}>Weekly: 150 pts</div>
            {['Artin', 'Aiden'].map(n => {
              const ws = weeklyScores[n] || 0;
              const pct = Math.min(100, Math.max(0, (ws / 150) * 100));
              return (
                <div key={n} style={{ marginBottom: 8 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.8rem', marginBottom: 3 }}>
                    <span>{n}</span>
                    <span style={{ color: ws >= 150 ? '#4F7942' : '#888' }}>{ws}/150 {ws >= 150 && 'üéâ'}</span>
                  </div>
                  <div style={{ height: 8, background: '#E5D4B7', borderRadius: 4 }}>
                    <div style={{ width: `${pct}%`, height: '100%', background: getColor(ws), borderRadius: 4 }} />
                  </div>
                </div>
              );
            })}
          </div>
          
          <div style={{ borderTop: '1px solid #E5D4B7', paddingTop: 10, marginTop: 10 }}>
            <div style={{ fontSize: '0.9rem', fontWeight: 600, color: '#4A4A4A', marginBottom: 8, textAlign: 'center' }}>Today</div>
            {['Artin', 'Aiden'].map(n => {
              const state = dailyStates[n] || {};
              const pos = Object.values(state).filter(s => s === 'positive').length;
              const neg = Object.values(state).filter(s => s === 'negative').length;
              const total = Object.values(behaviorsByCategory).reduce((s, c) => s + c.items.length, 0);
              return (
                <div key={n} style={{ marginBottom: 6, display: 'flex', alignItems: 'center', gap: 8 }}>
                  <span style={{ fontSize: '0.8rem', width: 45 }}>{n}</span>
                  <div style={{ flex: 1, height: 10, background: '#E5D4B7', borderRadius: 5, display: 'flex', overflow: 'hidden' }}>
                    <div style={{ width: `${(pos/total)*100}%`, background: '#4F7942' }} />
                    <div style={{ width: `${(neg/total)*100}%`, background: '#B85C38' }} />
                  </div>
                  <span style={{ fontSize: '0.75rem', color: '#888' }}>{pos+neg}/{total}</span>
                </div>
              );
            })}
          </div>
        </div>
      )}

      {view === 'rewards' && (
        <div style={{ background: 'white', borderRadius: 14, padding: 12, boxShadow: '0 3px 12px rgba(0,0,0,0.06)', border: '1px solid #E5D4B7', maxHeight: 450, overflowY: 'auto' }}>
          <div style={{ fontSize: '0.85rem', color: '#666', marginBottom: 10, textAlign: 'center' }}>
            {weekend ? 'üéÆ Weekend: Max 60 min/day' : 'üìÖ Weekday: Max 30 min/day'}
          </div>
          {['Artin', 'Aiden'].map(childName => (
            <div key={childName} style={{ marginBottom: 14 }}>
              <div style={{ fontSize: '1rem', fontWeight: 600, marginBottom: 8, display: 'flex', alignItems: 'center', gap: 6 }}>
                <div style={{ width: 18, height: 18, borderRadius: '50%', background: getColor(scores[childName]||0) }} />
                {childName} ({scores[childName]||0} pts)
              </div>
              {rewards.filter(r => weekend || r.category !== 'game-weekend').map(r => {
                const can = (scores[childName] || 0) >= r.points;
                return (
                  <div key={r.id} style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '8px 10px', marginBottom: 5, borderRadius: 8, background: can ? '#FEF7ED' : '#F5F5F5', border: `1px solid ${can ? '#E5D4B7' : '#EEE'}` }}>
                    <div style={{ width: 28, height: 28, borderRadius: 6, background: can ? '#C9A882' : '#CCC', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      <Icon name={r.icon} size={14} color="white" />
                    </div>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: '0.9rem', fontWeight: 600, color: '#4A4A4A' }}>{r.label}</div>
                      <div style={{ fontSize: '0.75rem', color: '#888' }}>{r.points} pts</div>
                    </div>
                    {can && isAdmin ? (
                      <button onClick={() => onClaimReward(childName, r)} style={{ padding: '6px 12px', borderRadius: 6, border: 'none', background: '#4F7942', color: 'white', fontSize: '0.8rem', fontWeight: 600, cursor: 'pointer' }}>Claim</button>
                    ) : can ? (
                      <span style={{ fontSize: '0.75rem', color: '#4F7942' }}>‚úì</span>
                    ) : (
                      <span style={{ fontSize: '0.75rem', color: '#999' }}>{r.points - (scores[childName]||0)}</span>
                    )}
                  </div>
                );
              })}
            </div>
          ))}
        </div>
      )}

      {view === 'history' && (
        <div style={{ background: 'white', borderRadius: 14, padding: 12, boxShadow: '0 3px 12px rgba(0,0,0,0.06)', border: '1px solid #E5D4B7' }}>
          {(() => {
            const allClaims = [];
            ['Artin', 'Aiden'].forEach(n => (claimHistory[n]||[]).forEach(c => allClaims.push({...c, child: n})));
            allClaims.sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
            if (!allClaims.length) return <div style={{ textAlign: 'center', padding: 24, color: '#888' }}><Icon name="Gift" size={28} color="#D4B996" /><p style={{ marginTop: 10, fontSize: '0.95rem' }}>No rewards claimed</p></div>;
            return (
              <div>
                <div style={{ fontSize: '0.95rem', fontWeight: 600, marginBottom: 10, textAlign: 'center' }}>Recent Rewards</div>
                {allClaims.slice(0,8).map((c,i) => {
                  const reward = rewards.find(r => r.id === c.rewardId);
                  return (
                    <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '8px 10px', background: '#F9F6F2', borderRadius: 8, marginBottom: 5 }}>
                      <div style={{ width: 24, height: 24, borderRadius: 6, background: c.child === 'Artin' ? '#87CEEB' : '#4F7942', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <Icon name={reward?.icon || 'Gift'} size={12} color="white" />
                      </div>
                      <div style={{ flex: 1 }}>
                        <div style={{ fontSize: '0.85rem', fontWeight: 600 }}>{c.child}: {reward?.label}</div>
                        <div style={{ fontSize: '0.7rem', color: '#888' }}>{formatDateTime(c.timestamp)}</div>
                      </div>
                      <span style={{ fontSize: '0.75rem', color: '#B85C38' }}>-{reward?.points}</span>
                    </div>
                  );
                })}
              </div>
            );
          })()}
        </div>
      )}
    </div>
  );
}

function MobileNav({ avatars }) {
  const scrollTo = (id) => document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  return (
    <div className="mobile-nav">
      <button onClick={() => scrollTo('artin-panel')} style={{ background: '#87CEEB', color: '#2C3E50' }}>
        {avatars.Artin ? <img src={avatars.Artin} alt="" style={{ width: 22, height: 22, borderRadius: '50%', objectFit: 'cover' }} /> : <Icon name="User" size={18} />}
        Artin
      </button>
      <button onClick={() => scrollTo('center-panel')} style={{ background: '#C9A882', color: 'white' }}>
        <Icon name="BarChart3" size={18} /> Stats
      </button>
      <button onClick={() => scrollTo('aiden-panel')} style={{ background: '#4F7942', color: 'white' }}>
        {avatars.Aiden ? <img src={avatars.Aiden} alt="" style={{ width: 22, height: 22, borderRadius: '50%', objectFit: 'cover' }} /> : <Icon name="User" size={18} />}
        Aiden
      </button>
    </div>
  );
}

function App() {
  const [authMode, setAuthMode] = useState(() => localStorage.getItem('bt_auth'));
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [history, setHistory] = useState({ Artin: [], Aiden: [] });
  const [claimHistory, setClaimHistory] = useState({ Artin: [], Aiden: [] });
  const [avatars, setAvatars] = useState({ Artin: null, Aiden: null });

  const isAdmin = authMode === 'admin';

  const scores = useMemo(() => calculateScores(history), [history]);
  const weeklyScores = useMemo(() => calculateWeeklyScores(history), [history]);
  const todayScores = useMemo(() => calculateTodayScores(history), [history]);
  const dailyStates = useMemo(() => buildDailyStates(history), [history]);

  useEffect(() => { if (authMode) loadData(); }, [authMode]);

  const loadData = async () => {
    setLoading(true);
    const savedAvatars = localStorage.getItem('bt_avatars');
    if (savedAvatars) setAvatars(JSON.parse(savedAvatars));

    try {
      const data = await api.getData();
      if (data && data.history) {
        setHistory(data.history);
        setClaimHistory(data.claimHistory || { Artin: [], Aiden: [] });
        localStorage.setItem('bt_data_v14', JSON.stringify({ history: data.history, claimHistory: data.claimHistory || {} }));
      } else {
        const saved = localStorage.getItem('bt_data_v14');
        if (saved) {
          const localData = JSON.parse(saved);
          setHistory(localData.history || { Artin: [], Aiden: [] });
          setClaimHistory(localData.claimHistory || { Artin: [], Aiden: [] });
        }
      }
    } catch (e) { 
      const saved = localStorage.getItem('bt_data_v14');
      if (saved) {
        const localData = JSON.parse(saved);
        setHistory(localData.history || { Artin: [], Aiden: [] });
        setClaimHistory(localData.claimHistory || { Artin: [], Aiden: [] });
      }
    }
    setLoading(false);
  };

  useEffect(() => {
    if (authMode && !loading) {
      localStorage.setItem('bt_data_v14', JSON.stringify({ history, claimHistory }));
    }
  }, [history, claimHistory, authMode, loading]);

  const handleAvatarUpload = (name, dataUrl) => {
    if (!isAdmin) return;
    const newAvatars = { ...avatars, [name]: dataUrl };
    setAvatars(newAvatars);
    localStorage.setItem('bt_avatars', JSON.stringify(newAvatars));
  };

  const record = async (child, item, type) => {
    if (!isAdmin) return;
    
    const todayStr = today();
    const behaviorId = item.id;
    const currentState = dailyStates[child]?.[behaviorId];
    
    if (currentState === type) return;
    
    setSaving(true);
    
    const newHistory = (history[child] || []).filter(entry => 
      !(entry.date === todayStr && extractBehaviorId(entry) === behaviorId)
    );
    
    const points = type === 'positive' ? item.points : -item.points;
    const label = type === 'positive' ? item.posLabel : item.negLabel;
    const entry = {
      id: `${behaviorId}-${type}-${Date.now()}`,
      behaviorId: `${behaviorId}-${type === 'positive' ? 'pos' : 'neg'}`,
      label,
      points,
      type,
      timestamp: new Date().toISOString(),
      date: todayStr
    };
    
    setHistory(h => ({ ...h, [child]: [entry, ...newHistory] }));

    try { await api.recordBehavior(child, entry); } catch (e) { console.error(e); }
    setSaving(false);
  };

  const undo = async (child) => {
    if (!isAdmin || !history[child]?.length) return;
    setSaving(true);
    setHistory(h => ({ ...h, [child]: h[child].slice(1) }));
    try { await api.undoLast(child); } catch (e) { console.error(e); }
    setSaving(false);
  };

  const resetChild = async (child) => {
    if (!isAdmin) return;
    if (!confirm(`Reset ${child}'s score and history?`)) return;
    setHistory(h => ({ ...h, [child]: [] }));
    try { await api.resetChild(child); } catch (e) { console.error(e); }
  };

  const claimReward = async (child, reward) => {
    if (!isAdmin || scores[child] < reward.points) return;
    
    const entry = {
      id: `reward-${reward.id}-${Date.now()}`,
      label: `Claimed: ${reward.label}`,
      points: -reward.points,
      type: 'reward',
      timestamp: new Date().toISOString(),
      date: today()
    };
    
    setHistory(h => ({ ...h, [child]: [entry, ...h[child]] }));
    setClaimHistory(ch => ({ ...ch, [child]: [{ rewardId: reward.id, timestamp: entry.timestamp, points: reward.points }, ...(ch[child] || [])] }));
    try { await api.claimReward(child, reward); } catch (e) { console.error(e); }
  };

  const logout = () => { localStorage.removeItem('bt_auth'); setAuthMode(null); };

  if (!authMode) return <PasswordScreen onUnlock={setAuthMode} />;
  
  if (loading) return (
    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
      <div style={{ textAlign: 'center' }}>
        <span className="spin" style={{ display: 'inline-block' }}><Icon name="Loader2" size={48} color="#C9A882" /></span>
        <p style={{ marginTop: 14, color: '#888', fontSize: '1rem' }}>Loading...</p>
      </div>
    </div>
  );

  return (
    <div style={{ minHeight: '100vh' }}>
      <header style={{ 
        background: isAdmin ? '#4F7942' : '#87CEEB', 
        padding: '10px 18px', color: isAdmin ? 'white' : '#2C3E50', 
        display: 'flex', justifyContent: 'space-between', alignItems: 'center',
        position: 'sticky', top: 0, zIndex: 100
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
          {isAdmin ? <Icon name="Shield" size={18} /> : <Icon name="Eye" size={18} />}
          <span style={{ fontWeight: 600, fontSize: '1.1rem' }}>Behavior Tracker</span>
          {saving && <span style={{ fontSize: '0.8rem', opacity: 0.8 }}>üíæ</span>}
        </div>
        <button onClick={logout} style={{ padding: '8px 12px', borderRadius: 8, border: 'none', background: 'rgba(255,255,255,0.2)', color: isAdmin ? 'white' : '#2C3E50', fontSize: '0.95rem', fontWeight: 500, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 5 }}>
          <Icon name="LogOut" size={16} /> Lock
        </button>
      </header>

      <MobileNav avatars={avatars} />

      <main className="three-panel" style={{ display: 'flex', gap: 16, padding: 16, maxWidth: 1400, margin: '0 auto', alignItems: 'flex-start' }}>
        <ChildPanel name="Artin" panelId="artin-panel" scores={scores} weeklyScores={weeklyScores} todayScores={todayScores} history={history} dailyStates={dailyStates} avatar={avatars.Artin} onRecord={record} onUndo={undo} onReset={resetChild} onAvatarUpload={handleAvatarUpload} loading={saving} isAdmin={isAdmin} />
        <CenterPanel scores={scores} weeklyScores={weeklyScores} history={history} dailyStates={dailyStates} claimHistory={claimHistory} onClaimReward={claimReward} isAdmin={isAdmin} />
        <ChildPanel name="Aiden" panelId="aiden-panel" scores={scores} weeklyScores={weeklyScores} todayScores={todayScores} history={history} dailyStates={dailyStates} avatar={avatars.Aiden} onRecord={record} onUndo={undo} onReset={resetChild} onAvatarUpload={handleAvatarUpload} loading={saving} isAdmin={isAdmin} />
      </main>

      <footer style={{ textAlign: 'center', padding: 14, color: '#888', fontSize: '0.85rem' }}>‚òÅÔ∏è Synced</footer>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
